{"ast":null,"code":"var _jsxFileName = \"/home/goik4/\\u0423\\u043D\\u0438\\u0432\\u0435\\u0440/corsework/Voice-Roulete-Coursework/Voice-Roulete-Coursework/roulete/client/src/routes/MainPage/MainPage.tsx\",\n  _s = $RefreshSig$();\nimport React from \"react\";\nimport io from \"socket.io-client\";\nconst socket = io(\"http://localhost:5000\");\nimport { useEffect, useState } from \"react\";\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport default function MainPage() {\n  _s();\n  const [stream, setStream] = useState();\n  async function getMedia(constrains) {\n    try {\n      const mediaStream = await navigator.mediaDevices.getUserMedia(constrains);\n      setStream(mediaStream);\n      handleMedia(mediaStream);\n    } catch (err) {\n      console.log(err);\n      alert(\"Не удалось получить доступ к микрофону\");\n    }\n  }\n  function handleMedia(stream) {\n    const options = {\n      mimeType: \"audio/webm; codecs=opus\"\n    };\n    const mediaRecorder = new MediaRecorder(stream, options);\n    const timeSlice = 1000;\n    mediaRecorder.start(timeSlice);\n    mediaRecorder.ondataavailable = function (event) {\n      if (event.data.size > 0) {\n        const reader = new FileReader();\n        reader.onload = function () {\n          const arrayBuffer = reader.result;\n          socket.emit(\"audioMessageSend\", arrayBuffer);\n        };\n        reader.readAsArrayBuffer(event.data);\n      }\n    };\n  }\n  useEffect(() => {\n    socket.on(\"audioMessageReceive\", audioData => {\n      if (audioData) {\n        const audioBlob = new Blob([audioData], {\n          type: \"audio/webm; codecs=opus\"\n        });\n        const audioUrl = URL.createObjectURL(audioBlob);\n        const audio = new Audio(audioUrl);\n        audio.addEventListener('loadeddata', () => {\n          URL.revokeObjectURL(audioUrl);\n          audio.play().then(() => {\n            console.log(\"Playback started\");\n          }).catch(err => {\n            console.error(\"Ошибка при воспроизведении:\", err);\n          });\n        });\n      }\n    });\n    return () => {\n      socket.off(\"audioMessageReceive\");\n      if (stream) {\n        stream.getTracks().forEach(track => track.stop());\n      }\n    };\n  }, [stream]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(\"section\", {\n      className: \"w-full h-full flex content-center items-center flex-col bg-cyan-500 mx-[500px] shadow-2xl shadow-black\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex flex-grow content-center items-center min-h-[200px] min-w-[200px] max-h-[200px] max-w-[200px]  mt-10\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"w-full h-full flex content-center  bg-anon bg-cover bg-no-repeat rounded-3xl \"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 66,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 65,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex pb-10 hover:transition-all hover:opacity-80 flex-col items-center justify-center\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => {\n            getMedia({\n              audio: true\n            });\n          },\n          className: \"bg-green-300 rounded-3xl text-3xl w-[250px] h-[40px] mb-5 mt-80 text-white\",\n          children: \"\\u041D\\u0430\\u0447\\u0430\\u0442\\u044C \\u043F\\u043E\\u0438\\u0441\\u043A\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 69,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-1xl\",\n          children: \"\\u041A\\u043E\\u043B\\u0438\\u0447\\u0435\\u0441\\u0442\\u0432\\u043E \\u043F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u0435\\u0439 \\u043E\\u043D\\u043B\\u0430\\u0439\\u043D:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 77,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 68,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 7\n    }, this)\n  }, void 0, false);\n}\n_s(MainPage, \"b6Ysyvrdb4049JcjYtF+4W6JT+M=\");\n_c = MainPage;\nvar _c;\n$RefreshReg$(_c, \"MainPage\");","map":{"version":3,"names":["React","io","socket","useEffect","useState","jsxDEV","_jsxDEV","Fragment","_Fragment","MainPage","_s","stream","setStream","getMedia","constrains","mediaStream","navigator","mediaDevices","getUserMedia","handleMedia","err","console","log","alert","options","mimeType","mediaRecorder","MediaRecorder","timeSlice","start","ondataavailable","event","data","size","reader","FileReader","onload","arrayBuffer","result","emit","readAsArrayBuffer","on","audioData","audioBlob","Blob","type","audioUrl","URL","createObjectURL","audio","Audio","addEventListener","revokeObjectURL","play","then","catch","error","off","getTracks","forEach","track","stop","children","className","fileName","_jsxFileName","lineNumber","columnNumber","onClick","_c","$RefreshReg$"],"sources":["/home/goik4/Универ/corsework/Voice-Roulete-Coursework/Voice-Roulete-Coursework/roulete/client/src/routes/MainPage/MainPage.tsx"],"sourcesContent":["import React from \"react\";\nimport io from \"socket.io-client\";\nconst socket = io(\"http://localhost:5000\");\nimport { useEffect, useState } from \"react\";\n\nexport default function MainPage() {\n  const [stream, setStream] = useState<MediaStream>();\n\n  async function getMedia(constrains: MediaStreamConstraints) {\n    try {\n      const mediaStream = await navigator.mediaDevices.getUserMedia(constrains);\n      setStream(mediaStream);\n      handleMedia(mediaStream);\n    } catch (err) {\n      console.log(err);\n      alert(\"Не удалось получить доступ к микрофону\");\n    }\n  }\n\n  function handleMedia(stream: MediaStream) {\n    const options = { mimeType: \"audio/webm; codecs=opus\" };\n    const mediaRecorder = new MediaRecorder(stream, options);\n    const timeSlice = 1000;\n    mediaRecorder.start(timeSlice);\n    mediaRecorder.ondataavailable = function (event) {\n      if (event.data.size > 0) {\n        const reader = new FileReader();\n        reader.onload = function () {\n          const arrayBuffer = reader.result;\n          socket.emit(\"audioMessageSend\", arrayBuffer);\n        };\n        reader.readAsArrayBuffer(event.data);\n      }\n    };\n  }\n\n  useEffect(() => {\n    socket.on(\"audioMessageReceive\", (audioData) => {\n      if (audioData) {\n        const audioBlob = new Blob([audioData], { type: \"audio/webm; codecs=opus\" });\n        const audioUrl = URL.createObjectURL(audioBlob);\n        const audio = new Audio(audioUrl);\n\n        audio.addEventListener('loadeddata', () => {\n          URL.revokeObjectURL(audioUrl); \n          audio.play().then(() => {\n              console.log(\"Playback started\");\n            }).catch((err) => {\n              console.error(\"Ошибка при воспроизведении:\", err);\n            });\n        });\n      }\n    });\n    return () => {\n      socket.off(\"audioMessageReceive\");\n      if (stream) {\n        stream.getTracks().forEach(track => track.stop());\n      }\n    };\n  }, [stream]); \n\n  return (\n    <>\n      <section className=\"w-full h-full flex content-center items-center flex-col bg-cyan-500 mx-[500px] shadow-2xl shadow-black\">\n        <div className=\"flex flex-grow content-center items-center min-h-[200px] min-w-[200px] max-h-[200px] max-w-[200px]  mt-10\">\n          <div className=\"w-full h-full flex content-center  bg-anon bg-cover bg-no-repeat rounded-3xl \"></div>\n        </div>\n        <div className=\"flex pb-10 hover:transition-all hover:opacity-80 flex-col items-center justify-center\">\n          <button\n            onClick={() => {\n              getMedia({ audio: true });\n            }}\n            className=\"bg-green-300 rounded-3xl text-3xl w-[250px] h-[40px] mb-5 mt-80 text-white\"\n          >\n            Начать поиск\n          </button>\n          <p className=\"text-1xl\">Количество пользователей онлайн:</p>\n        </div>\n      </section>\n    </>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}